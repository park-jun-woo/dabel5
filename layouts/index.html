{{ define "main" }}
{{ if .Params.tagline }}
{{/* ===== About / Landing page ===== */}}
<div class="dabel-page">

  <section class="dabel-hero">
    <div class="dabel-inner">
      <h1 class="dabel-title">DABEL5</h1>
      <p class="dabel-acronym">
        <span class="dabel-hl">D</span>yson modules from
        <span class="dabel-hl">A</span>steroid
        <span class="dabel-hl">B</span>elt to
        <span class="dabel-hl">E</span>arth
        <span class="dabel-hl">L5</span>
      </p>
      <p class="dabel-tagline">{{ .Params.tagline }}</p>
      <p class="dabel-desc">{{ .Params.description }}</p>
      {{ with .Params.cta_label }}<a class="dabel-cta" href="{{ "why/" | relLangURL }}">{{ . }}</a>{{ end }}
    </div>
  </section>

{{ if .Params.why_title }}
  {{/* ===== NEW: 4-section storytelling layout ===== */}}

  {{/* ① Why */}}
  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.why_title }}</h2>
      <p class="dabel-lead">{{ .Params.why_lead }}</p>
      <div class="dabel-flow">
        <div class="dabel-flow-items">
          {{ $len := len .Params.why_flow }}
          {{ range $i, $item := .Params.why_flow }}
          <span>{{ $item }}</span>{{ if lt (add $i 1) $len }}<span class="dabel-flow-arrow">&rarr;</span>{{ end }}
          {{ end }}
        </div>
      </div>
      <blockquote class="dabel-quote">
        "{{ .Params.why_quote }}"
      </blockquote>
    </div>
  </section>

  {{/* ② Loop */}}
  <section class="dabel-section dabel-section-alt">
    <div class="dabel-inner">
      <h2>{{ .Params.loop_title }}</h2>
      <p class="dabel-lead">{{ .Params.loop_lead }}</p>
      <div class="dabel-loop-cards">
        {{ $len := len .Params.loop_nodes }}
        {{ range $i, $node := .Params.loop_nodes }}
        <div class="dabel-loop-card">
          <strong>{{ $node.title }}</strong>
          <span>{{ $node.detail | safeHTML }}</span>
        </div>
        {{ if lt (add $i 1) $len }}<span class="dabel-loop-card-arrow">&rarr;</span>{{ end }}
        {{ end }}
      </div>
      <p class="dabel-loop-caption">{{ .Params.loop_caption | safeHTML }}</p>
      {{ with .Params.loop_quote }}
      <blockquote class="dabel-quote">"{{ . }}"</blockquote>
      {{ end }}
    </div>
  </section>

  {{/* ③ Module stats */}}
  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.module_title }}</h2>
      <p class="dabel-lead">{{ .Params.module_lead | safeHTML }}</p>
      <div class="dabel-stats">
        {{ range .Params.module_stats }}
        <div class="dabel-stat">
          <div class="dabel-stat-value">{{ .value | safeHTML }}</div>
          <div class="dabel-stat-label">{{ .label }}</div>
          <div class="dabel-stat-note">{{ .note }}</div>
        </div>
        {{ end }}
      </div>
      <p class="dabel-footnote">{{ .Params.module_footnote | safeHTML }}</p>
    </div>
  </section>

  {{/* ④ Scale + closing + CTA */}}
  <section class="dabel-section dabel-section-alt">
    <div class="dabel-inner">
      <h2>{{ .Params.scale_title }}</h2>
      <p class="dabel-lead">{{ .Params.scale_lead }}</p>
      <div class="dabel-table-wrap">
        <table class="dabel-table">
          <thead>
            <tr>
              {{ range .Params.scale_headers }}
              <th>{{ . }}</th>
              {{ end }}
            </tr>
          </thead>
          <tbody>
            {{ range .Params.scale_rows }}
            <tr{{ if .hl }} class="dabel-table-hl{{ if .accent }} dabel-table-accent{{ end }}"{{ end }}>
              {{ range .cells }}
              <td>{{ . | safeHTML }}</td>
              {{ end }}
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      <p class="dabel-footnote">{{ .Params.scale_footnote | safeHTML }}</p>
      <div class="dabel-section-closing">
        {{ with .Params.scale_timeline }}
        <p class="dabel-scale-timeline">{{ . }}</p>
        {{ end }}
        {{ with .Params.scale_closing }}
        <p class="dabel-closing-text">{{ . | safeHTML }}</p>
        {{ end }}
        {{ with .Params.scale_cta_label }}
        <a class="dabel-cta" href="{{ "why/" | relLangURL }}">{{ . }}</a>
        {{ end }}
      </div>
    </div>
  </section>

{{ else }}
  {{/* ===== ORIGINAL: Full layout (9 sections) ===== */}}

  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.core_title }}</h2>
      <p class="dabel-lead">{{ .Params.core_lead }}</p>
      <div class="dabel-flow">
        <div class="dabel-flow-items">
          {{ range .Params.core_flow }}
          <span>{{ . }}</span><span class="dabel-flow-arrow">&rarr;</span>
          {{ end }}
        </div>
      </div>
      <blockquote class="dabel-quote">
        "{{ .Params.core_quote }}"
      </blockquote>
    </div>
  </section>

  <section class="dabel-section dabel-section-alt">
    <div class="dabel-inner">
      <h2>{{ .Params.module_title }}</h2>
      <p class="dabel-lead">{{ .Params.module_lead | safeHTML }}</p>
      <div class="dabel-stats">
        {{ range .Params.module_stats }}
        <div class="dabel-stat">
          <div class="dabel-stat-value">{{ .value | safeHTML }}</div>
          <div class="dabel-stat-label">{{ .label }}</div>
          <div class="dabel-stat-note">{{ .note }}</div>
        </div>
        {{ end }}
      </div>
      <p class="dabel-footnote">{{ .Params.module_footnote | safeHTML }}</p>
    </div>
  </section>

  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.roadmap_title }}</h2>
      <p class="dabel-lead">{{ .Params.roadmap_lead }}</p>
      <div class="dabel-timeline">
        {{ range $i, $s := .Params.seasons }}
        <div class="dabel-season" data-season="{{ $s.num }}">
          <div class="dabel-season-head">
            <span class="dabel-season-num">S{{ $s.num }}</span>
            <span class="dabel-season-icon">{{ $s.icon | safeHTML }}</span>
          </div>
          <div class="dabel-season-body">
            <h3>{{ $s.name | safeHTML }}</h3>
            <p class="dabel-season-meta">{{ $s.episodes }}</p>
            <p>{{ $s.desc }}</p>
            <p class="dabel-season-line">"{{ $s.line }}"</p>
          </div>
        </div>
        {{ end }}
      </div>
    </div>
  </section>

  <section class="dabel-section dabel-section-alt">
    <div class="dabel-inner">
      <h2>{{ .Params.loop_title }}</h2>
      <p class="dabel-lead">{{ .Params.loop_lead }}</p>
      <div class="dabel-loop-cards">
        {{ $len := len .Params.loop_nodes }}
        {{ range $i, $node := .Params.loop_nodes }}
        <div class="dabel-loop-card">
          <strong>{{ $node.title }}</strong>
          <span>{{ $node.detail | safeHTML }}</span>
        </div>
        {{ if lt (add $i 1) $len }}<span class="dabel-loop-card-arrow">&rarr;</span>{{ end }}
        {{ end }}
      </div>
      <p class="dabel-loop-caption">{{ .Params.loop_caption | safeHTML }}</p>
    </div>
  </section>

  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.scale_title }}</h2>
      <p class="dabel-lead">{{ .Params.scale_lead }}</p>
      <div class="dabel-table-wrap">
        <table class="dabel-table">
          <thead>
            <tr>
              {{ range .Params.scale_headers }}
              <th>{{ . }}</th>
              {{ end }}
            </tr>
          </thead>
          <tbody>
            {{ range .Params.scale_rows }}
            <tr{{ if .hl }} class="dabel-table-hl{{ if .accent }} dabel-table-accent{{ end }}"{{ end }}>
              {{ range .cells }}
              <td>{{ . | safeHTML }}</td>
              {{ end }}
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
      <p class="dabel-footnote">{{ .Params.scale_footnote | safeHTML }}</p>
    </div>
  </section>

  <section class="dabel-section dabel-section-alt">
    <div class="dabel-inner">
      <h2>{{ .Params.quotes_title }}</h2>
      <div class="dabel-quotes">
        {{ range .Params.quotes }}
        <blockquote class="dabel-quote-card">
          <p>"{{ .text }}"</p>
          {{ with .cite }}<cite>{{ . }}</cite>{{ end }}
        </blockquote>
        {{ end }}
      </div>
    </div>
  </section>

  <section class="dabel-section">
    <div class="dabel-inner">
      <h2>{{ .Params.arch_title }}</h2>
      <p class="dabel-lead">{{ .Params.arch_lead }}</p>
      <div class="dabel-arch">
        {{ range .Params.arch_nodes }}
        <div class="dabel-arch-node {{ .class }}">
          <div class="dabel-arch-label">{{ .label }}</div>
          <div class="dabel-arch-name">{{ .name }}</div>
          <div class="dabel-arch-detail">{{ .detail | safeHTML }}</div>
        </div>
        {{ end }}
      </div>
    </div>
  </section>

  <section class="dabel-section dabel-closing">
    <div class="dabel-inner">
      <p class="dabel-closing-text">{{ .Params.closing_text | safeHTML }}</p>
      <p class="dabel-motto">"This is DABEL5. We engineer the future."</p>
    </div>
  </section>

{{ end }}
</div>
{{ else }}
{{/* ===== Fallback section listing (languages without about content) ===== */}}
<div class="content-wrap">
  {{ .Content }}
  {{ range .Pages }}
    {{ if not (in .RelPermalink "/languages/") }}
    <article class="post-item">
      <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
      {{ with .Params.summary }}<p>{{ . }}</p>{{ end }}
      {{ if not .Date.IsZero }}<time>{{ .Date.Format "2006-01-02" }}</time>{{ end }}
    </article>
    {{ end }}
  {{ end }}
  <div class="home-bottom-links">
    {{ with .OutputFormats.Get "RSS" }}<a href="{{ .RelPermalink }}">RSS</a>{{ end }}
    <a href="{{ "languages/" | relLangURL }}">Languages</a>
  </div>
</div>
{{ end }}
{{ end }}
